import pytest

from core_lib.utils.json_schema_util import (
    validate,
    JSON_SCHEMA_2020_12_DRAFT,
    BOOLEAN,
    STRING,
    EMAIL_STRING,
    get_schema_validator,
)

JSON_TO_VALIDATE_SCHEMA = USER_DATA_MODEL_SCHEMA = {
    **JSON_SCHEMA_2020_12_DRAFT,
    "title": "TestJsonSchema",
    "type": "object",
    "properties": {
        "name": STRING,
        "email": EMAIL_STRING,
        "is_deleted": BOOLEAN,
    },
    "required": ["name", "email"],
}


@validate({"json_to_validate": get_schema_validator(JSON_TO_VALIDATE_SCHEMA)})
def function_input_to_validate(json_to_validate: dict):
    return json_to_validate


def test_function_input_to_validate():
    json_to_validate = {"name": "foo", "email": "test@gmail.com"}

    assert (
        function_input_to_validate(json_to_validate=json_to_validate)
        == json_to_validate
    )


def test_function_input_to_validate_invalid_email():
    json_to_validate = {"name": "foo", "email": "invalid_email"}

    with pytest.raises(Exception):
        function_input_to_validate(json_to_validate=json_to_validate)
