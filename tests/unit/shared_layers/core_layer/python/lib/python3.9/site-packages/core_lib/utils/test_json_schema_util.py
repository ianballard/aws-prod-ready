import pytest

from core_lib.utils.json_schema_util import (
    JSON_SCHEMA_2020_12_DRAFT,
    BOOLEAN,
    STRING,
    EMAIL_STRING,
    get_schema_validator,
    NULLABLE_UUID_STRING,
    validate_json,
)

JSON_TO_VALIDATE_SCHEMA = USER_DATA_MODEL_SCHEMA = {
    **JSON_SCHEMA_2020_12_DRAFT,
    "title": "TestJsonSchema",
    "type": "object",
    "properties": {
        "name": STRING,
        "email": EMAIL_STRING,
        "is_deleted": BOOLEAN,
        "created_by": NULLABLE_UUID_STRING,
    },
    "required": ["name", "email"],
}


def test_function_input_to_validate():
    json_to_validate = {"name": "foo", "email": "test@gmail.com", "created_by": None}
    assert (
        validate_json(
            json=json_to_validate,
            validator=get_schema_validator(JSON_TO_VALIDATE_SCHEMA),
        )
        is None
    )


def test_function_input_to_validate_invalid_email():
    json_to_validate = {"name": "foo", "email": "invalid_email"}

    with pytest.raises(Exception):
        validate_json(
            json=json_to_validate,
            validator=get_schema_validator(JSON_TO_VALIDATE_SCHEMA),
        )
