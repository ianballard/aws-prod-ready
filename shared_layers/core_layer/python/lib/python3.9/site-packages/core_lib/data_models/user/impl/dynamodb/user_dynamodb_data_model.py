from core_lib.data_models.model import EntityType
from core_lib.services.database.impl.dynamodb_service import build_new_item

USER_ENTITY_TYPE = EntityType.User
USER_ASSOCIATION_ENTITY_TYPE = EntityType.UserAssociation


def build_formatted_user_id(user_id: str):
    return f"{USER_ENTITY_TYPE.value}-{user_id}"


def build_user_item_key(_id: str) -> dict:
    return {"pk": USER_ENTITY_TYPE.value, "sk": f"{build_formatted_user_id(_id)}"}


def build_new_user(user):
    user["pk"] = USER_ENTITY_TYPE.value
    user["sk"] = build_formatted_user_id(user["profile"])
    user["entity_type"] = USER_ENTITY_TYPE.value
    return build_new_item(user)


def build_user_association(user_a_id: str, user_b_id: str):
    user = {
        "pk": build_formatted_user_id(user_a_id),
        "sk": build_formatted_user_id(user_b_id),
        "entity_type": USER_ASSOCIATION_ENTITY_TYPE.value,
    }
    return build_new_item(user)
