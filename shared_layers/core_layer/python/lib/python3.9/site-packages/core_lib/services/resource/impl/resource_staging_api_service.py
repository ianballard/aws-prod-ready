import boto3

from core_lib.utils.args_util import get_non_null_kwargs

resource_staging_api_client = boto3.client("resourcegroupstaggingapi")


def get_resources(**kwargs):
    response = resource_staging_api_client.get_resources(
        **get_non_null_kwargs(**kwargs)
    )
    return {
        "pagination_token": response.get("PaginationToken"),
        "resource_arns": [
            resource.get("ResourceARN")
            for resource in response.get("ResourceTagMappingList")
        ],
    }


def get_lambda_resources_by_function_role(
    function_role_tag_value: str, pagination_token: str = None
):
    return get_resources(
        TagFilters=[
            {
                "Key": "function_role",
                "Values": [
                    function_role_tag_value,
                ],
            },
        ],
        ResourceTypeFilters=[
            "lambda:function",
        ],
        PaginationToken=pagination_token,
    )
