import boto3

from core_lib.services.parameter.parameter_service import (
    get_parameter_value,
    ParameterName,
)
from core_lib.utils.log_util import log_unexpected_exception

s3_client = boto3.client("s3")
s3_resource = boto3.resource("s3")
S3_APP_STORAGE_BUCKET = None


def get_app_storage_bucket():
    global S3_APP_STORAGE_BUCKET

    if S3_APP_STORAGE_BUCKET is None:
        S3_APP_STORAGE_BUCKET = get_parameter_value(ParameterName.S3_APP_STORAGE_BUCKET)

    return S3_APP_STORAGE_BUCKET


def upload(bucket_name: str, key: str, content):
    try:
        return s3_resource.Object(bucket_name=bucket_name, key=key).put(Body=content)
    except Exception as e:
        log_unexpected_exception(e)


def download(bucket_name: str, key: str):
    try:
        return s3_client.get_object(bucket_name=bucket_name, key=key)
    except Exception as e:
        log_unexpected_exception(e)
